---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import mcqData from "../../../../content/aws/sap-c02/mcqs/high-availability.json";

const { exam, topic, questions } = mcqData;
---

<BaseLayout
  title={`${exam} – ${topic} | AWS Cert Lab`}
  description="AWS SAP-C02 high availability drills."
  currentExam="sap-c02"
>
  <section class="surface hero">
    <div class="eyebrow">SAP-C02</div>
    <h1>{topic}</h1>
    <p class="lede">
      Rapid-fire scenarios to build intuition for {exam} high availability and resilient architectures.
    </p>
    <div class="meta">
      <span class="chip">Exam: {exam}</span>
      <span class="chip">Questions: {questions.length}</span>
      <span class="chip">Pattern: multi-AZ & failure domains</span>
    </div>
  </section>

  <section class="grid">
    {questions.map((q, idx) => (
      <article class="card mcq-card" data-correct={q.correctIndex}>
        <div class="card-header">
          <div class="pill">Question {idx + 1}</div>
          <span class="badge">ID: {q.id}</span>
        </div>
        <h3>{q.question}</h3>
        <div class="options">
          {q.options.map((opt, index) => (
            <button class="option" data-index={index} type="button">
              <span class="dot"></span>
              <span>{opt}</span>
              <span class="check" aria-hidden="true">✓</span>
            </button>
          ))}
        </div>
        <div class="explanation">
          <div class="label">Explanation</div>
          <p>{q.explanation}</p>
        </div>
      </article>
    ))}
  </section>

  <aside class="surface recap">
    <div class="recap-row">
      <div>
        <p class="eyebrow">Streak</p>
        <h2 id="score">0 / {questions.length}</h2>
      </div>
      <div>
        <p class="eyebrow">Answered</p>
        <h2 id="answered">0</h2>
      </div>
      <button class="ghost" type="button" id="reset">Reset session</button>
    </div>
    <p class="tiny">
      Tip: Pretend you are advising a builder. Pick the option that minimizes blast radius while staying
      operationally light.
    </p>
  </aside>

  <style>
    .hero h1 {
      margin: 8px 0 12px;
      letter-spacing: -0.03em;
      font-size: clamp(28px, 4vw, 40px);
    }
    .hero .lede {
      color: var(--muted);
      max-width: 720px;
      margin: 0 0 16px;
      line-height: 1.6;
    }
    .eyebrow {
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 0.14em;
      color: var(--muted);
    }
    .meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
      margin: 24px 0;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      padding: 20px;
      border-radius: 16px;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(109, 236, 185, 0.04), rgba(130, 180, 255, 0.05));
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }
    .card:hover::before {
      opacity: 1;
    }
    .card h3 {
      margin: 12px 0 14px;
      font-size: 18px;
      line-height: 1.4;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .pill {
      background: rgba(255, 255, 255, 0.05);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--border);
    }
    .badge {
      color: var(--muted);
      font-size: 12px;
    }
    .options {
      display: grid;
      gap: 10px;
    }
    .option {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 12px 14px;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: space-between;
      transition: border 0.2s ease, transform 0.1s ease;
    }
    .option:hover {
      transform: translateY(-1px);
      border-color: rgba(109, 236, 185, 0.7);
    }
    .option .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid var(--border);
      flex-shrink: 0;
    }
    .option .check {
      opacity: 0;
      color: var(--accent);
      font-weight: 700;
    }
    .option.correct {
      border-color: rgba(109, 236, 185, 0.9);
      background: rgba(109, 236, 185, 0.1);
    }
    .option.correct .dot {
      border-color: var(--accent);
      background: var(--accent);
    }
    .option.correct .check {
      opacity: 1;
    }
    .option.wrong {
      border-color: rgba(255, 107, 107, 0.8);
      background: rgba(255, 107, 107, 0.08);
    }
    .explanation {
      margin-top: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px dashed var(--border);
      border-radius: 12px;
      display: none;
    }
    .explanation .label {
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .recap {
      margin-top: 22px;
    }
    .recap-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .ghost {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: border 0.2s ease, transform 0.1s ease;
    }
    .ghost:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }
    .tiny {
      color: var(--muted);
      margin-top: 12px;
      line-height: 1.5;
    }
    @media (max-width: 720px) {
      .recap-row {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>

  <script>
    const shuffle = (arr) => {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    };

    const grid = document.querySelector('.grid');
    const shuffledCards = shuffle([...grid.querySelectorAll('.mcq-card')]);
    shuffledCards.forEach((card) => grid.appendChild(card));

    const cards = shuffledCards;
    const scoreEl = document.querySelector('#score');
    const answeredEl = document.querySelector('#answered');
    const resetBtn = document.querySelector('#reset');
    const total = cards.length;

    let score = 0;
    let answered = 0;

    const updateScore = () => {
      scoreEl.textContent = `${score} / ${total}`;
      answeredEl.textContent = answered;
    };

    cards.forEach(card => {
      const correct = card.dataset.correct;
      const optionsContainer = card.querySelector('.options');
      const optionNodes = [...optionsContainer.querySelectorAll('.option')];
      const shuffledOptions = shuffle(optionNodes);
      shuffledOptions.forEach(opt => optionsContainer.appendChild(opt));

      const options = shuffledOptions;
      const explanation = card.querySelector('.explanation');

      options.forEach(opt => {
        opt.addEventListener('click', () => {
          const alreadyAnswered = card.dataset.answered === 'true';

          options.forEach(o => o.classList.remove('correct', 'wrong'));

          if (opt.dataset.index === correct) {
            opt.classList.add('correct');
            if (!alreadyAnswered) score += 1;
          } else {
            opt.classList.add('wrong');
            card.querySelector(`.option[data-index="${correct}"]`).classList.add('correct');
          }

          if (!alreadyAnswered) {
            answered += 1;
            card.dataset.answered = 'true';
          }

          explanation.style.display = 'block';
          updateScore();
        });
      });
    });

    resetBtn.addEventListener('click', () => {
      score = 0;
      answered = 0;
      cards.forEach(card => {
        card.dataset.answered = 'false';
        card.querySelectorAll('.option').forEach(opt => opt.classList.remove('correct', 'wrong'));
        card.querySelector('.explanation').style.display = 'none';
      });
      updateScore();
    });

    updateScore();
  </script>
</BaseLayout>
